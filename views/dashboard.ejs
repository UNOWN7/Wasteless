<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WasteLess - Dashboard</title>
    <link rel="stylesheet" href="bootstrap.min.css">
    <link rel="stylesheet" href="font-awesome.min.css">
    <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-green.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="index.css">
</head>
<body>
    
    <!-- Header -->
    <header id="header" class="sticky">
        <nav class="navbar navbar-expand-lg navbar-light">
            <a class="navbar-brand" href="#">&nbsp;&nbsp;
                <img src="recycling-icon.svg" style="height: 40px;width: 40px;"> &nbsp;WasteLess
            </a>
            
          
        </nav>
    </header>

    <br><br>

    <div class="container-dashboard">
        <!-- Sidebar -->
        <aside id="sidebar">
            <ul class="sidebar-nav">
                <li class="sidebar-link"><a href="#" onclick="showSection('home')">Home</a></li>
                <li class="sidebar-link"><a href="#" onclick="showSection('profile')">User Profile</a></li>
                <li class="sidebar-link"><a href="#" onclick="showSection('history')">History</a></li>
                <li class="sidebar-link"><a href="#" onclick="showSection('submit-waste')">Submit Waste</a></li>
                <li class="sidebar-link"><a href="/logout">Logout</a></li>
            </ul>
        </aside>

        <!-- Main Content -->
        <div class="main">
            <div id="home" class="content-section">
                <section class="hero">
                    <div class="overlay">
                        <div class="container text-center">
                            <h1>Save Your Planet</h1>
                            <p>Recycle your waste and earn rewards.</p>
                            
                        </div>
                    </div>
                </section>
                </div>
                
            <!-- User Profile Section -->
            <div id="profile" class="content-section">
                <div class="container rounded bg-white mt-5 mb-5">
                    <div class="row">
                        <div class="col-md-3 border-right">
                            <div class="d-flex flex-column align-items-center text-center p-3 py-5">
                                <img class="rounded-circle mt-5" width="150px" src="https://st3.depositphotos.com/15648834/17930/v/600/depositphotos_179308454-stock-illustration-unknown-person-silhouette-glasses-profile.jpg">
                                <span class="font-weight-bold"><%= user.name %></span>
                                <span class="text-black-50"><%= user.email %></span>
                            </div>
                        </div>
                        <div class="col-md-5 border-right">
                            <div class="p-3 py-5">
                                <h4 class="text-right">Profile Settings</h4>
                                <form action="/update-profile" method="POST">
                                    <div class="row mt-2">
                                        <div class="col-md-6"><label class="labels">Name</label><input type="text" class="form-control" name="name" value="<%= user.name %>"></div>
                                        <div class="col-md-6"><label class="labels">Email</label><input type="text" class="form-control" name="email" value="<%= user.email %>"></div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-md-12"><label class="labels">Address</label><input type="text" class="form-control" name="address" value="<%= user.address %>"></div>
                                    </div>
                                    <div class="mt-5 text-center"><button class="btn btn-primary profile-button" type="submit">Save Profile</button></div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="history" class="content-section">
                <h2>Recycling History</h2>
                <div class="history-container">
                    <% if (wasteItems.length > 0) { %>
                        <% wasteItems.forEach(transaction => { %>
                            <div class="history-box">
                                <table>
                                    <tr>
                                        <th>Waste Type</th>
                                        <td><%= transaction.WasteItem.type %></td>
                                    </tr>
                                    <tr>
                                        <th>Quantity</th>
                                        <td><%= transaction.WasteItem.quantity %> kg</td>
                                    </tr>
                                    <tr>
                                        <th>Status</th>
                                        <td><%= transaction.status %></td>
                                    </tr>
                                    <tr>
                                        <th>Company</th>
                                        <td>
                                            <% if (transaction.status === 'Accepted' || transaction.status === 'Picked Up') { %>
                                                <%= transaction.Company ? transaction.Company.name : 'Pending' %>
                                            <% } else { %>
                                                Pending
                                            <% } %>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        <% }) %>
                    <% } else { %>
                        <p>No waste submissions yet.</p>
                    <% } %>
                </div>
            </div>
            
            
            
            
            
            <!-- Submit Waste Section -->
            <div id="submit-waste" class="content-section" style="display: none;">
                <h2>Submit Waste</h2>
                
                <form id="wasteForm">
                    <label for="type">Waste Type:</label>
                    <input type="text" name="type" id="type" required>
                    
                    <label for="quantity">Quantity (kg):</label>
                    <input type="number" name="quantity" id="quantity" required>
                    
                    <label for="address">Pickup Address:</label>
                    <input type="text" name="address" id="address" required>
                    
                    <button type="submit">Submit</button>
                </form>
            
                <!-- Message Box -->
                <div id="message-box" style="display: none; color: green; margin-top: 10px;">
                    Waste submitted successfully! Refreshing...
                </div>
            </div>

        </div>
    </div>

    <script src="/bootstrap.bundle.min.js"></script>
    <script>
        function showSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(sectionId).style.display = 'block';
        }


        document.getElementById('wasteForm').addEventListener('submit', async function(event) {
    event.preventDefault();

    const type = document.getElementById('type').value;
    const quantity = document.getElementById('quantity').value;
    const address = document.getElementById('address').value;
    const userId = "<%= user.id %>";  // Ensure user ID is available in EJS

    try {
        const response = await fetch('/submit-waste', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ type, quantity, address, userId })
        });

        const result = await response.json();
        console.log('Server Response:', result);

        if (response.ok) {
            document.getElementById('message-box').style.display = 'block';
            setTimeout(() => { location.reload(); }, 2000);
        } else {
            alert(result.message || 'Error submitting waste.');
        }
    } catch (error) {
        alert('Server error. Please try again.');
    }
});
    </script>

</body>
</html>
